-- 1. 切换数据库
CREATE DATABASE IF NOT EXISTS ods_hbase;
USE ods_hbase;


DROP TABLE IF EXISTS order_info_hive;

-- 3. 创建无分区的 HBase 映射表
CREATE EXTERNAL TABLE order_info_hive (
rowkey STRING,        
order_id STRING,      
create_time STRING,   
amount STRING,        
status STRING         
)
STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'
WITH SERDEPROPERTIES (
"hbase.columns.mapping" = ":key,cf:order_id,cf:create_time,cf:amount,cf:status"
)
TBLPROPERTIES (
"hbase.table.name" = "ods:order_info",  
"hbase.client.scanner.caching" = "500"  
);


-- 1. 查询 HBase 预分区 hash_00 的数据（RowKey 以 hash_00| 开头）
SELECT rowkey, order_id, create_time, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_00|%'; 

-- 2. 查询 HBase 预分区 hash_01 的数据
SELECT rowkey, order_id, create_time, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_01|%';

-- 3. 结合时间范围查询（RowKey 含时间戳，二次过滤）
SELECT rowkey, order_id, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_02|%'  
AND create_time BETWEEN '2025-10-01 00:00:00' AND '2025-10-02 23:59:59';



select *
from order_info_hive;